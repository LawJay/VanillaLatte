<!--
@Date:   2017-03-10T13:44:54+00:00
@Last modified time: 2017-04-25T14:48:18+01:00
-->



<html>

<head>
    <title>Rotten Tatties Movie lookup </title>
    <meta charset="utf-8">
    <meta name="Author" content="Murray Lyne, Jamie Law, Jordan youngman, Joe McDonald">
    <meta name="Desciption" content="This is our website!">
  <!-- foundation css framework reference -->
    <link rel="stylesheet" href="css/foundation.css">
    <meta name="viewport" content="width=device-width">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- personal css -->
    <link rel="stylesheet" href="css/app.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--jquery-->
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.1.1.min.js"></script>
    <!-- foundation javascript -->
    <script src="js/vendor/foundation.js"></script>
    <script src="js/vendor/what-input.js"></script>
    <script src="js/konami/konami.js"></script>

    </script>
    <script>
        $(function() {
            $('#search').submit(function() {
                var query = $("#searchbar").val();
                getMovies(query);
                return false;
            });
        });

        //get an array of movies

        function getMovies(query) {
            var url = "http://www.omdbapi.com/?s=" + query + "&type=movie";
            $.getJSON(url, function(jsondata) {
                //handle what we've found.
                changePosters(jsondata)
            });
        }
var itseaster = false;


var easter_egg = new Konami(function() { alert('Konami Code!'); itseaster = true;});

        function changePosters(jsondata) {
            //clear out all the img tags in movieList
            $('#movieList').empty();
            //now, add in new img tags.


            if (itseaster){
              $('html').css('background-image','url(Media/pepe.jpg)');
              var audio = new Audio('meme.mp3');
              audio.play();
              var imgstring = "";
              var limit = 10;
              var totalResults = jsondata.totalResults;
              if(totalResults <= 10) {

                limit = totalResults;
              }
              for (var i = 0; i < limit; i++) {
                  var poster = "Media/easter_egg.jpg";
                  var id = jsondata.Search[i].imdbID;

                  //if there's no poster, use jordan's classy potato.

                  if (poster === "N/A") {
                      poster = "Media/easter_egg.jpg";
                  }

                  imgstring += "<img src='" + poster + "'alt='Media/easter_egg.jpg'" + "class='movieimg' id='" + id + "'>";
                  //append the img string
              }
              $("#movieList").append(imgstring);
              hover();
              changeImg();
            }
            else
            {
            var imgstring = "";
            var limit = 10;
            var totalResults = jsondata.totalResults;
            if(totalResults <= 10) {

              limit = totalResults;
            }
            for (var i = 0; i < limit; i++) {
                var poster = jsondata.Search[i].Poster;
                var id = jsondata.Search[i].imdbID;

                //if there's no poster, use jordan's classy potato.

                if (poster === "N/A") {
                    poster = "/Media/potato.png";
                }

                imgstring += "<img src='" + poster + "'alt='/Media/potato.png'" + "class='movieimg' id='" + id + "'>";
                //append the img string
            }
            $("#movieList").append(imgstring);
            hover();
            changeImg();
          }
        }

    </script>
    <script>
    //function to change the image
        function changeImg() {
            $(document).ready(function() {
                $('.movieimg').click(function() {
                    var currentimage = $(this).attr('src');
                    var imdbID = $(this).attr('id');
                    $('#mainImg').attr('src', currentimage);
                    //get the plot and title from what the id embedded on the img's id attribute.
                    getTitle(imdbID)
                });
            });
        }
        //get the title of the current image by using the imdbID from the id attribute to pull more data.
        function getTitle(id) {
            //prepare the url
            var url2 = "http://www.omdbapi.com/?i=" + id + "&plot=short"
            $.getJSON(url2, function(jsondata) {
                //handle the results.
                changeTitle(jsondata)
            });
        }

        function changeTitle(jsondata) {
            //clear the old out. we'll add it back in.
            var title = jsondata.Title;
            var plot = jsondata.Plot;
            var director = jsondata.Director;
            var awards = jsondata.Awards;
            var year = jsondata.Year;
            var rating = jsondata.Rated;

            if(awards === "N/A") {
              awards = "No awards";
            }
            //add in the information after clearing the html of the old tags
            $('#movieTitle').empty();
            $('#movieTxt').empty();
            $('#year').empty();
            $('#director').empty();
            $('#awards').empty();
            if(itseaster){
            $('#movieTitle').append("M' Lady");
            $('#movieTxt').append("If you want sick memes you have came to the right place darling.");
            $('#year').append("Released in " + "1996" + ". Rated " + "PG");
            $('#director').append("Directed by " + "Murray Lyne");
            $('#awards').append("Awards: Them All!");
          } else {
            $('#movieTitle').append(title);
            $('#movieTxt').append(plot);
            $('#year').append("Released in " + year + ". Rated " + rating);
            $('#director').append("Directed by " + director);
            $('#awards').append(awards);
          }

            //REVIEWS
            if(itseaster){
            var metascore = "100";
            var imdbrating = "10";
            var votes = "1,000,000";
            console.log(jsondata.Ratings);
            for (var i=0; i < jsondata.Ratings.length; i++) {
              if (jsondata.Ratings[i].Source === "Rotten Tomatoes") {
                var rottentomatoes = "100%";
              }
            }
          } else {
            var metascore = jsondata.Metascore;
            var imdbrating = jsondata.imdbRating;
            var votes = jsondata.imdbVotes;
            console.log(jsondata.Ratings);
            for (var i=0; i < jsondata.Ratings.length; i++) {
              if (jsondata.Ratings[i].Source === "Rotten Tomatoes") {
                var rottentomatoes = jsondata.Ratings[i].Value;
              }
            }
          }

            if (rottentomatoes === "undefined") {
              rottentomatoes = "No score found"
            } else {
              rottentomatoes.concat("%");
            }

            //these strings prep the data in a html format.
            var metacriticString = "<h5>MetaCritc </h5>" + metascore + " of 100";
            var imdbString = "<h5>IMDB</h5>" + imdbrating + "/10" + "<br>" + "Based on " + votes + " Votes";
            var rottentomatoesstring = "<h5> Rotten Tomatoes </h5>" + rottentomatoes;

            $('#metacritic').empty();
            $('#imdb').empty();
            $('#rottentomatoes').empty();
            $('#metacritic').append(metacriticString);
            $('#imdb').append(imdbString);
            $('#rottentomatoes').append(rottentomatoesstring)

            //CAST
            if (itseaster) {
              var notableActors = "Murray Lyne";
            } else {
            var notableActors = jsondata.Actors;
          }

            //empty the element
            $('#actorslist').empty();

            //add in the new actors, but split the data if possible.
            var actors = notableActors.split(",");
            for(var i = 0; i < actors.length; i++) {
              $('#actorslist').append("<li> " + actors[i] + "</li>");
            }


        }
        changeImg(); //reload the function
    </script>

    <script>
    //When you hover over an image, it will lose it's opacity.
        function hover() {
            $(document).ready(function() {
                $('.movieimg').hover(function() {
                    $(this).css('border-color', '#D4AF37')
                    $(this).css('opacity', '1')
                }, function() {
                    $(this).css('border-color', '#000026')
                    $(this).css('opacity', '0.6')
                });
            });
        }
        hover(); //reload the function
    </script>

    <link rel="icon" type="image/png" href="Media/favicon.png">

    <script>

    </script>

</head>

<body>
  <!-- <body background="/Media/background.jpg"> -->

        <header>
            <img src="/Media/tatties_logo.png" alt="">
            <form id="search">
                <div class="SearchBar">
                    <input type="search" placeholder="Enter Search Query Here..." id="searchbar" class="search"></search>
                </div>
                <input type="submit" name="searchButton" value="Search!" id="searchbutton">
            </form>
        </header>

        <main>
            <div class="row">
                <div class="movieList large-8 small-3 medium-5" id="movieList">
                </div>
            </div>

            <div class="row">
                <h2 class="test"></h2>
                <div class="landscape-img">
                    <img src="http://myfantasyart.com/wp-content/uploads/2013/07/pacific-rim-movie-poster-images-f4-1400x643.jpg" alt="Movie poster">
                    <h1><span>
                      Movie Title
                    </span></h1>
                </div>

                <div class="mainMovie large-8 small-3 medium-5">

                  <div class="posterImage">
                    <img src="/Media/potato.png" alt="img" class="mainMovieImg" id="mainImg">
                  </div>

                    <div class="movieBasicInfo">
                        <h2 class="movieTitle" id="movieTitle"></h2>
                        <P class="movieTxt" id="movieTxt">Search something up, then click an image!</p>
                        <p id="year"></p>
                        <p id="director"></p>
                        <p id="awards"></p>
                    </div>
                </div>
            </div>
            <br>
            <div class="bottompage">
                <div class="row">



                    <div class="castDiv"font-family: 'Indie Flower', cursive;>
                        <div class="large-8 small-3 medium-5 cast">
                            <h2> Notable actors </h2>
                          <div id="actors">
                            <ul id="actorslist">
                            </ul>
                          </div>
                        </div>
                    </div>

                    <div class="reviewDiv"font-family: 'Indie Flower', cursive;>
                        <div class="large-8 small-3 medium-5 movieReviews">

                            <h2> Reviews </h2>
                            <p id="metacritic"></p>
                            <br>
                            <p id="imdb"></p>
                            <br>
                            <p id="rottentomatoes">

                        </div>
                    </div>

                </div>
            </div>
        </main>
        <footer>Copyright Vanilla Latte Inc © All Rights Reserved</footer>
    </body>

</html>

<!--
@Date:   2017-03-10T13:44:54+00:00
@Last modified time: 2017-03-22T12:03:20+00:00
-->



<html>

<head>
    <title>Rotten Tatties Mobile Design</title>
    <meta charset="utf-8">
    <meta name="Author" content="Murray Lyne, Jamie Law, Jordan youngman, Joe 'ma bobby' MacDonald">
    <meta name="Desciption" content="Mobile orientated design.
  This is part of mobile first design">
    <link rel="stylesheet" href="css/foundation.css">
    <meta name="viewport" content="width=device-width">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/app.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<script src="js/vendor/jquery.js"></script>-->
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.1.1.min.js"></script>
    <script src="js/vendor/foundation.js"></script>
    <script src="js/vendor/what-input.js"></script>
    <script>
        $(function() {
            $('#search').submit(function() {
                var query = $("#searchbar").val();
                getMovies(query);
                return false;
            });
        });

        //get an array of movies

        function getMovies(query) {
            var url = "http://www.omdbapi.com/?s=" + query + "&type=movie";
            $.getJSON(url, function(jsondata) {
                //handle what we've found.
                console.log(jsondata);
                changePosters(jsondata)
            });
        }

        function changePosters(jsondata) {
            //clear out all the img tags in movieList
            $('#movieList').empty();
            //now, add in new img tags.
            var imgstring = "";
            var limit = 10;
            var totalResults = jsondata.totalResults;
            if(totalResults <= 10) {

              limit = totalResults;
            }
            for (var i = 0; i < limit; i++) {
                var poster = jsondata.Search[i].Poster;
                var id = jsondata.Search[i].imdbID;
                console.log(poster);

                $(function() {
                    $.ajax(poster, {
                        statusCode: {
                            403: function() {
                                poster = "/Media/potato.png"
                            }
                        }
                    })

                });

                if (poster === "N/A") {
                    poster = "/Media/potato.png";
                } else {
                    console.log(poster);
                }
                imgstring += "<img src='" + poster + "'alt='/Media/potato.png'" + "class='movieimg' id='" + id + "'>";
                //append the img string
            }
            $("#movieList").append(imgstring);
            hover();
            changeImg();
        }
    </script>
    <script>
    //function to change the image
        function changeImg() {
            $(document).ready(function() {
                $('.movieimg').click(function() {
                    var currentimage = $(this).attr('src');
                    var imdbID = $(this).attr('id');
                    $('#mainImg').attr('src', currentimage);
                    //get the plot and title from what the id embedded on the img's id attribute.
                    getTitle(imdbID)
                });
            });
        }
        //get the title of the current image by using the imdbID from the id attribute to pull more data.
        function getTitle(id) {
            //prepare the url
            var url2 = "http://www.omdbapi.com/?i=" + id + "&plot=short&tomatos=true"
            $.getJSON(url2, function(jsondata) {
                //handle the results.
                changeTitle(jsondata)
            });
        }

        function changeTitle(jsondata) {
            //clear the old out. we'll add it back in.
            var title = jsondata.Title;
            var plot = jsondata.Plot;
            var director = jsondata.Director;
            var awards = jsondata.Awards;
            var year = jsondata.Year;
            var rating = jsondata.Rated;

            if(awards === "N/A") {
              awards = "No awards";
            }
            //add in the information after clearing the html of the old tags
            $('#movieTitle').empty();
            $('#movieTxt').empty();
            $('#year').empty();
            $('#director').empty();
            $('#awards').empty();
            $('#movieTitle').append(title);
            $('#movieTxt').append(plot);
            $('#year').append("Released in " + year + ". Rated " + rating);
            $('#director').append("Directed by " + director);
            $('#awards').append(awards);

            //REVIEWS
            var metascore = jsondata.Metascore;
            var imdbrating = jsondata.imdbRating;
            var votes = jsondata.imdbVotes;

            //these string prep the data in a html format.
            var metacriticString = "<h5>MetaCritc </h5>" + metascore + " of 100";
            var imdbString = "<h5>IMDB</h5>" + imdbrating + "/10" + "<br>" + "Based on " + votes + " Votes";
            $('#metacritic').empty();
            $('#imdb').empty();

            $('#metacritic').append(metacriticString);
            $('#imdb').append(imdbString);

            //CAST
        }
        changeImg();
    </script>

    <script>
        function hover() {
            $(document).ready(function() {
                $('.movieimg').hover(function() {
                    $(this).css('border-color', '#D4AF37')
                    $(this).css('opacity', '1')
                }, function() {
                    $(this).css('border-color', '#000026')
                    $(this).css('opacity', '0.6')
                });
            });
        }
        hover();
    </script>


    <link rel="icon" type="image/png" href="Media/favicon.png">
</head>

<body>

    <body background="/Media/background.jpg">

        <header>
            <img src="/Media/tatties_logo.png" alt="">
            <form id="search">
                <div class="SearchBar">
                    <input type="search" placeholder="Enter Search Query Here..." id="searchbar" class="search"></search>
                </div>
                <input type="submit" name="searchButton" value="Search!" id="searchbutton">
            </form>
        </header>

        <main>
            <div class="row">
                <div class="movieList large-8 small-3 medium-5" id="movieList">
                </div>
            </div>

            <div class="row">
                <h2 class="test"></h2>
                <div class="landscape-img">
                    <img src="http://myfantasyart.com/wp-content/uploads/2013/07/pacific-rim-movie-poster-images-f4-1400x643.jpg" alt="Movie poster">
                    <h1><span>
                      Movie Title
                    </span></h1>
                </div>

                <div class="mainMovie large-8 small-3 medium-5">
                    <img src="/Media/potato.png" alt="img" class="mainMovieImg" id="mainImg">

                    <div class="movieBasicInfo">
                        <h2 class="movieTitle" id="movieTitle"></h2>
                        <P class="movieTxt" id="movieTxt">Search something up, then click an image!</p>
                        <p id="year"></p>
                        <p id="director"></p>
                        <p id="awards"></p>
                    </div>
                </div>
            </div>
            <br>
            <div class="bottompage">
                <div class="row">



                    <div class="castDiv"font-family: 'Indie Flower', cursive;>
                        <div class="large-8 small-3 medium-5 cast">
                            <h2> Cast </h2>
                            <p>Cast text</p>
                        </div>
                    </div>

                    <div class="mediaDiv"font-family: 'Indie Flower', cursive;>
                        <div class="large-8 small-3 medium-5 media">

                            <h2> Media </h2>
                            <p>Media text</p>
                        </div>
                    </div>
                    <div class="reviewDiv"font-family: 'Indie Flower', cursive;>
                        <div class="large-8 small-3 medium-5 movieReviews">

                            <h2> Reviews </h2>
                            <p id="metacritic"></p>
                            <br>
                            <p id="imdb"></p>
                            <br>
                            <ul id="reviewlist">
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
        </main>
        <footer>Copyright Vanilla Latte Inc Â© All Rights Reserved</footer>
    </body>

</html>
